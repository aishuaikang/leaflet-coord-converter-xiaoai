(function(e,c){typeof exports=="object"&&typeof module!="undefined"?module.exports=c(require("leaflet")):typeof define=="function"&&define.amd?define(["leaflet"],c):(e=typeof globalThis!="undefined"?globalThis:e||self,e.CoordConverter=c(e.L))})(this,function(e){"use strict";return e.CoordConverter=class{constructor(){this.pi=Math.PI,this.a=6378245,this.ee=.006693421622965943,this.x_pi=this.pi*3e3/180,this.R=6378137}bd09ToGps84(t,s){const i=this.bd09ToGcj02(t,s);return this.gcj02ToGps84(i.lng,i.lat)}gps84ToBd09(t,s){const i=this.gps84ToGcj02(t,s);return this.gcj02ToBd09(i.lng,i.lat)}gps84ToGcj02(t,s){let i=this._transformLat(t-105,s-35),o=this._transformLng(t-105,s-35);const r=s/180*this.pi;let n=Math.sin(r);n=1-this.ee*n*n;const h=Math.sqrt(n);i=i*180/(this.a*(1-this.ee)/(n*h)*this.pi),o=o*180/(this.a/h*Math.cos(r)*this.pi);const a=s+i;return{lng:t+o,lat:a}}gcj02ToGps84(t,s){const i=this._transform(t,s),o=t*2-i.lng,r=s*2-i.lat;return{lng:o,lat:r}}gcj02ToBd09(t,s){const i=Math.sqrt(t*t+s*s)+2e-5*Math.sin(s*this.x_pi),o=Math.atan2(s,t)+3e-6*Math.cos(t*this.x_pi),r=i*Math.cos(o)+.0065,n=i*Math.sin(o)+.006;return{lng:r,lat:n}}bd09ToGcj02(t,s){const i=t-.0065,o=s-.006,r=Math.sqrt(i*i+o*o)-2e-5*Math.sin(o*this.x_pi),n=Math.atan2(o,i)-3e-6*Math.cos(i*this.x_pi),h=r*Math.cos(n),a=r*Math.sin(n);return{lng:h,lat:a}}convertArray(t,s,i){if(s===i)return t;const o={gps84_gcj02:this.gps84ToGcj02.bind(this),gps84_bd09:this.gps84ToBd09.bind(this),gcj02_gps84:this.gcj02ToGps84.bind(this),gcj02_bd09:this.gcj02ToBd09.bind(this),bd09_gps84:this.bd09ToGps84.bind(this),bd09_gcj02:this.bd09ToGcj02.bind(this)},r=`${s}_${i}`,n=o[r];if(!n)throw new Error(`不支持的转换类型: ${s} -> ${i}`);return t.map(h=>n(h.lng,h.lat))}_transform(t,s){let i=this._transformLat(t-105,s-35),o=this._transformLng(t-105,s-35);const r=s/180*this.pi;let n=Math.sin(r);n=1-this.ee*n*n;const h=Math.sqrt(n);i=i*180/(this.a*(1-this.ee)/(n*h)*this.pi),o=o*180/(this.a/h*Math.cos(r)*this.pi);const a=s+i;return{lng:t+o,lat:a}}_transformLat(t,s){let i=-100+2*t+3*s+.2*s*s+.1*t*s+.2*Math.sqrt(Math.abs(t));return i+=(20*Math.sin(6*t*this.pi)+20*Math.sin(2*t*this.pi))*2/3,i+=(20*Math.sin(s*this.pi)+40*Math.sin(s/3*this.pi))*2/3,i+=(160*Math.sin(s/12*this.pi)+320*Math.sin(s*this.pi/30))*2/3,i}_transformLng(t,s){let i=300+t+2*s+.1*t*t+.1*t*s+.1*Math.sqrt(Math.abs(t));return i+=(20*Math.sin(6*t*this.pi)+20*Math.sin(2*t*this.pi))*2/3,i+=(20*Math.sin(t*this.pi)+40*Math.sin(t/3*this.pi))*2/3,i+=(150*Math.sin(t/12*this.pi)+300*Math.sin(t/30*this.pi))*2/3,i}},e.coordConverter=new e.CoordConverter,e.coordConvert=function(){return e.coordConverter},e.GridLayer.include({_setZoomTransform:function(t,s,i){let o=s;o!=null&&this.options&&(this.options.coordType==="gcj02"?o=e.coordConverter.gps84ToGcj02(s.lng,s.lat):this.options.coordType==="bd09"&&(o=e.coordConverter.gps84ToBd09(s.lng,s.lat)));const r=this._map.getZoomScale(i,t.zoom),n=t.origin.multiplyBy(r).subtract(this._map._getNewPixelOrigin(o,i)).round();e.Browser.any3d?e.DomUtil.setTransform(t.el,n,r):e.DomUtil.setPosition(t.el,n)},_getTiledPixelBounds:function(t){let s=t;s!=null&&this.options&&(this.options.coordType==="gcj02"?s=e.coordConverter.gps84ToGcj02(t.lng,t.lat):this.options.coordType==="bd09"&&(s=e.coordConverter.gps84ToBd09(t.lng,t.lat)));const i=this._map,o=i._animatingZoom?Math.max(i._animateToZoom,i.getZoom()):i.getZoom(),r=i.getZoomScale(o,this._tileZoom),n=i.project(s,this._tileZoom).floor(),h=i.getSize().divideBy(r*2);return new e.Bounds(n.subtract(h),n.add(h))}}),e.CoordConverter});
